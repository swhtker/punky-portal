<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noindex, nofollow">
<title>Punky ‚Äî Autonomous Agent Platform</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg-deep:#0a0e17;--bg-surface:#111827;--bg-card:#1a2233;--bg-hover:#243044;
  --border:#2a3a52;--border-active:#3b82f6;
  --text:#e2e8f0;--text-muted:#94a3b8;--text-dim:#64748b;
  --accent:#3b82f6;--accent-glow:rgba(59,130,246,.15);
  --green:#22c55e;--red:#ef4444;--amber:#f59e0b;--purple:#a855f7;--cyan:#06b6d4;
  --font-body:'DM Sans',system-ui,sans-serif;
  --font-mono:'JetBrains Mono',monospace;
  --radius:10px;--radius-sm:6px;
}
html,body,#root{height:100%;background:var(--bg-deep);color:var(--text);font-family:var(--font-body)}
a{color:var(--accent);text-decoration:none}
input,select,textarea{font-family:inherit;font-size:inherit}

/* Layout */
.app{display:flex;height:100vh}
.sidebar{width:240px;background:var(--bg-surface);border-right:1px solid var(--border);display:flex;flex-direction:column;flex-shrink:0}
.sidebar-brand{padding:20px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px}
.sidebar-brand h1{font-size:20px;font-weight:700;letter-spacing:-.5px}
.sidebar-brand .dot{width:10px;height:10px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green)}
.sidebar-nav{flex:1;padding:12px;display:flex;flex-direction:column;gap:2px}
.nav-item{padding:10px 14px;border-radius:var(--radius-sm);cursor:pointer;display:flex;align-items:center;gap:10px;font-size:14px;font-weight:500;color:var(--text-muted);transition:all .15s}
.nav-item:hover{background:var(--bg-hover);color:var(--text)}
.nav-item.active{background:var(--accent-glow);color:var(--accent);font-weight:600}
.nav-item svg{width:18px;height:18px;opacity:.7}
.nav-section{font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--text-dim);padding:16px 14px 6px;font-weight:600}
.sidebar-footer{padding:16px;border-top:1px solid var(--border);font-size:12px;color:var(--text-dim)}

.main{flex:1;display:flex;flex-direction:column;overflow:hidden}
.topbar{height:56px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 24px;flex-shrink:0}
.topbar h2{font-size:16px;font-weight:600}
.topbar-actions{display:flex;align-items:center;gap:12px}
.content{flex:1;overflow-y:auto;padding:24px}

/* Cards */
.card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:20px}
.card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px;margin-bottom:24px}
.stat-card{text-align:center}
.stat-value{font-size:32px;font-weight:700;font-family:var(--font-mono);line-height:1.2}
.stat-label{font-size:13px;color:var(--text-muted);margin-top:4px}

/* Buttons */
.btn{padding:8px 16px;border-radius:var(--radius-sm);font-size:13px;font-weight:600;border:none;cursor:pointer;display:inline-flex;align-items:center;gap:6px;transition:all .15s}
.btn-primary{background:var(--accent);color:#fff}.btn-primary:hover{filter:brightness(1.15)}
.btn-secondary{background:var(--bg-hover);color:var(--text);border:1px solid var(--border)}.btn-secondary:hover{border-color:var(--accent)}
.btn-danger{background:var(--red);color:#fff}
.btn-sm{padding:5px 10px;font-size:12px}
.btn:disabled{opacity:.5;cursor:not-allowed}

/* Forms */
.form-group{margin-bottom:16px}
.form-group label{display:block;font-size:13px;font-weight:500;color:var(--text-muted);margin-bottom:6px}
.form-input{width:100%;padding:10px 14px;background:var(--bg-surface);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text);font-size:14px;outline:none;transition:border-color .15s}
.form-input:focus{border-color:var(--accent)}
.form-input::placeholder{color:var(--text-dim)}
select.form-input{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2394a3b8'%3E%3Cpath d='M6 8L1 3h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center}

/* Table */
.table-wrap{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:13px}
th{text-align:left;padding:10px 14px;color:var(--text-muted);font-weight:600;font-size:12px;text-transform:uppercase;letter-spacing:.5px;border-bottom:1px solid var(--border)}
td{padding:10px 14px;border-bottom:1px solid var(--border)}
tr:hover td{background:var(--bg-hover)}

/* Badges */
.badge{display:inline-block;padding:3px 8px;border-radius:99px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.3px}
.badge-green{background:rgba(34,197,94,.15);color:var(--green)}
.badge-red{background:rgba(239,68,68,.15);color:var(--red)}
.badge-amber{background:rgba(245,158,11,.15);color:var(--amber)}
.badge-blue{background:rgba(59,130,246,.15);color:var(--accent)}
.badge-purple{background:rgba(168,85,247,.15);color:var(--purple)}

/* Login */
.login-wrap{display:flex;align-items:center;justify-content:center;height:100vh;background:var(--bg-deep)}
.login-card{width:420px;padding:40px;background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius)}
.login-card h1{font-size:28px;font-weight:700;margin-bottom:8px;letter-spacing:-.5px}
.login-card .subtitle{color:var(--text-muted);margin-bottom:28px;font-size:14px}
.tab-row{display:flex;gap:4px;margin-bottom:24px;background:var(--bg-surface);border-radius:var(--radius-sm);padding:3px}
.tab-btn{flex:1;padding:8px;text-align:center;border:none;background:transparent;color:var(--text-muted);border-radius:4px;cursor:pointer;font-size:13px;font-weight:500}
.tab-btn.active{background:var(--bg-card);color:var(--text)}

/* Chat */
.chat-container{display:flex;flex-direction:column;height:calc(100vh - 56px)}
.chat-messages{flex:1;overflow-y:auto;padding:24px;display:flex;flex-direction:column;gap:16px}
.chat-msg{max-width:80%;padding:12px 16px;border-radius:var(--radius);font-size:14px;line-height:1.6}
.chat-msg.user{align-self:flex-end;background:var(--accent);color:#fff;border-bottom-right-radius:4px}
.chat-msg.ai{align-self:flex-start;background:var(--bg-card);border:1px solid var(--border);border-bottom-left-radius:4px}
.chat-msg .meta{font-size:11px;color:var(--text-dim);margin-top:6px}
.chat-input-bar{padding:16px 24px;border-top:1px solid var(--border);display:flex;gap:12px}
.chat-input-bar input{flex:1}
.typing-dot{display:inline-block;width:6px;height:6px;border-radius:50%;background:var(--text-muted);animation:pulse 1.2s infinite}
.typing-dot:nth-child(2){animation-delay:.2s}.typing-dot:nth-child(3){animation-delay:.4s}
@keyframes pulse{0%,80%,100%{opacity:.3}40%{opacity:1}}

/* Guardian cards */
.guardian-card{display:flex;align-items:center;gap:14px;padding:16px;background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);transition:border-color .15s}
.guardian-card:hover{border-color:var(--accent)}
.guardian-avatar{width:42px;height:42px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0}
.guardian-info{flex:1}
.guardian-name{font-weight:600;font-size:14px}
.guardian-role{font-size:12px;color:var(--text-muted)}

/* Responsive */
@media(max-width:768px){.sidebar{display:none}.content{padding:16px}}

/* Animation */
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
.fade-in{animation:fadeIn .3s ease}
.mono{font-family:var(--font-mono)}
.text-muted{color:var(--text-muted)}
.text-green{color:var(--green)}
.text-red{color:var(--red)}
.text-amber{color:var(--amber)}
.mt-4{margin-top:16px}
.mb-4{margin-bottom:16px}
.flex{display:flex}.gap-3{gap:12px}.items-center{align-items:center}.justify-between{justify-content:space-between}
.w-full{width:100%}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useCallback, useRef, createContext, useContext } = React;

// ‚îÄ‚îÄ‚îÄ Config ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const API = window.location.hostname === 'localhost'
  ? 'http://localhost:8081'
  : 'https://api.jspriggins.com';

// ‚îÄ‚îÄ‚îÄ Auth Context ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const AuthCtx = createContext(null);

function useAuth() {
  return useContext(AuthCtx);
}

async function apiFetch(path, opts = {}, token) {
  const headers = { 'Content-Type': 'application/json', ...opts.headers };
  if (token) headers['Authorization'] = `Bearer ${token}`;
  const res = await fetch(`${API}${path}`, { ...opts, headers });
  if (res.status === 401) throw new Error('UNAUTHORIZED');
  const data = await res.json().catch(() => ({}));
  if (!res.ok) throw new Error(data.detail || `HTTP ${res.status}`);
  return data;
}

// ‚îÄ‚îÄ‚îÄ Icons (minimal inline SVGs) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const Icons = {
  dashboard: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>,
  chat: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>,
  agents: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="8" r="4"/><path d="M20 21a8 8 0 10-16 0"/></svg>,
  runs: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="5,3 19,12 5,21"/></svg>,
  billing: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>,
  shield: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
  settings: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>,
  logout: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16,17 21,12 16,7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>,
  plus: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
  refresh: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23,4 23,10 17,10"/><path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/></svg>,
};

// ‚îÄ‚îÄ‚îÄ Login / Bootstrap Page ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function LoginPage({ onAuth }) {
  const [mode, setMode] = useState('login');
  const [form, setForm] = useState({ email: '', password: '', name: '', tenant: '', slug: '' });
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true); setError('');
    try {
      if (mode === 'login') {
        const data = await apiFetch('/v1/auth/login', {
          method: 'POST',
          body: JSON.stringify({ email: form.email, password: form.password }),
        });
        onAuth(data.access_token, form.email);
      } else {
        const slug = form.slug || form.tenant.toLowerCase().replace(/[^a-z0-9]/g, '-');
        const data = await apiFetch('/v1/bootstrap', {
          method: 'POST',
          body: JSON.stringify({
            tenant_name: form.tenant, tenant_slug: slug,
            owner_email: form.email, owner_name: form.name, owner_password: form.password,
          }),
        });
        onAuth(data.access_token, form.email);
      }
    } catch (err) {
      setError(err.message);
    }
    setLoading(false);
  };

  const set = (k) => (e) => setForm({ ...form, [k]: e.target.value });

  return (
    <div className="login-wrap">
      <div className="login-card fade-in">
        <div style={{display:'flex',alignItems:'center',gap:10,marginBottom:4}}>
          <div style={{width:12,height:12,borderRadius:'50%',background:'var(--green)',boxShadow:'0 0 10px var(--green)'}}/>
          <h1>Punky</h1>
        </div>
        <p className="subtitle">Self-hosted autonomous agent platform</p>
        <div className="tab-row">
          <button className={`tab-btn ${mode==='login'?'active':''}`} onClick={()=>setMode('login')}>Sign In</button>
          <button className={`tab-btn ${mode==='bootstrap'?'active':''}`} onClick={()=>setMode('bootstrap')}>Create Account</button>
        </div>
        <form onSubmit={handleSubmit}>
          {mode === 'bootstrap' && <>
            <div className="form-group">
              <label>Organisation Name</label>
              <input className="form-input" placeholder="Acme Corp" value={form.tenant} onChange={set('tenant')} required/>
            </div>
            <div className="form-group">
              <label>Your Name</label>
              <input className="form-input" placeholder="Jane Smith" value={form.name} onChange={set('name')} required/>
            </div>
          </>}
          <div className="form-group">
            <label>Email</label>
            <input className="form-input" type="email" placeholder="you@company.com" value={form.email} onChange={set('email')} required/>
          </div>
          <div className="form-group">
            <label>Password</label>
            <input className="form-input" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value={form.password} onChange={set('password')} required minLength={8}/>
          </div>
          {error && <p style={{color:'var(--red)',fontSize:13,marginBottom:12}}>{error}</p>}
          <button className="btn btn-primary w-full" style={{width:'100%',padding:'12px',fontSize:14}} disabled={loading}>
            {loading ? 'Working...' : mode === 'login' ? 'Sign In' : 'Create Organisation'}
          </button>
        </form>
        <p style={{marginTop:20,fontSize:12,color:'var(--text-dim)',textAlign:'center'}}>
          Provider-agnostic AI ¬∑ Your data, your infrastructure
        </p>
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ Dashboard ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function Dashboard({ token }) {
  const [stats, setStats] = useState(null);
  const [guardians, setGuardians] = useState([]);

  useEffect(() => {
    const load = async () => {
      try {
        const [agents, runs, plans, gs] = await Promise.all([
          apiFetch('/v1/agents', {}, token),
          apiFetch('/v1/runs', {}, token),
          apiFetch('/v1/billing/plans', {}, token),
          apiFetch('/v1/platform/guardians/status', {}, token),
        ]);
        setStats({
          agents: (agents.agents || agents || []).length,
          runs: (runs.runs || runs || []).length,
          plans: (plans.plans || plans || []).length,
          completed: (runs.runs || runs || []).filter(r => r.status === 'completed').length,
        });
        setGuardians((gs.guardians || []).slice(0, 6));
      } catch (e) { console.error(e); }
    };
    load();
  }, [token]);

  if (!stats) return <div className="text-muted" style={{padding:40}}>Loading dashboard...</div>;

  return (
    <div className="fade-in">
      <div className="card-grid">
        <div className="card stat-card">
          <div className="stat-value text-green">{stats.agents}</div>
          <div className="stat-label">Active Agents</div>
        </div>
        <div className="card stat-card">
          <div className="stat-value" style={{color:'var(--cyan)'}}>{stats.runs}</div>
          <div className="stat-label">Total Runs</div>
        </div>
        <div className="card stat-card">
          <div className="stat-value text-amber">{stats.completed}</div>
          <div className="stat-label">Completed</div>
        </div>
        <div className="card stat-card">
          <div className="stat-value" style={{color:'var(--purple)'}}>{guardians.length}</div>
          <div className="stat-label">Guardians Active</div>
        </div>
      </div>

      <h3 style={{fontSize:15,fontWeight:600,marginBottom:12}}>Guardian Agents</h3>
      <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(280px,1fr))',gap:12}}>
        {guardians.map((g, i) => (
          <div className="guardian-card" key={i}>
            <div className="guardian-avatar" style={{background: g.status === 'active' ? 'rgba(34,197,94,.15)' : 'rgba(245,158,11,.15)'}}>
              {g.emoji || 'üõ°Ô∏è'}
            </div>
            <div className="guardian-info">
              <div className="guardian-name">{g.name}</div>
              <div className="guardian-role">{g.role || g.focus || 'Guardian'}</div>
            </div>
            <span className={`badge ${g.status==='active'?'badge-green':'badge-amber'}`}>{g.status}</span>
          </div>
        ))}
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ Chat Page ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function ChatPage({ token }) {
  const [agents, setAgents] = useState([]);
  const [agentId, setAgentId] = useState('');
  const [messages, setMessages] = useState([]);
  const [input, setInput] = useState('');
  const [loading, setLoading] = useState(false);
  const msgsRef = useRef(null);

  useEffect(() => {
    apiFetch('/v1/agents', {}, token).then(d => {
      const list = d.agents || d || [];
      setAgents(list);
      if (list.length > 0) setAgentId(list[0].id);
    }).catch(() => {});
  }, [token]);

  useEffect(() => {
    if (msgsRef.current) msgsRef.current.scrollTop = msgsRef.current.scrollHeight;
  }, [messages]);

  const send = async () => {
    if (!input.trim() || !agentId || loading) return;
    const userMsg = input.trim();
    setInput('');
    setMessages(prev => [...prev, { role: 'user', text: userMsg }]);
    setLoading(true);

    try {
      const run = await apiFetch('/v1/runs', {
        method: 'POST',
        body: JSON.stringify({ agent_id: agentId, input_text: userMsg }),
      }, token);

      // Poll for completion
      let result = run;
      for (let i = 0; i < 30 && result.status !== 'completed' && result.status !== 'failed'; i++) {
        await new Promise(r => setTimeout(r, 1000));
        result = await apiFetch(`/v1/runs/${run.id}`, {}, token);
      }

      const aiText = result.output_text || result.error || 'No response received.';
      const meta = `${result.model_name || ''} ¬∑ ${result.total_input_tokens||0}+${result.total_output_tokens||0} tokens ¬∑ $${(result.total_cost_usd||0).toFixed(4)}`;
      setMessages(prev => [...prev, { role: 'ai', text: aiText, meta }]);
    } catch (err) {
      setMessages(prev => [...prev, { role: 'ai', text: `Error: ${err.message}` }]);
    }
    setLoading(false);
  };

  return (
    <div className="chat-container">
      <div style={{padding:'12px 24px',borderBottom:'1px solid var(--border)',display:'flex',alignItems:'center',gap:12}}>
        <span className="text-muted" style={{fontSize:13}}>Agent:</span>
        <select className="form-input" style={{width:280,padding:'6px 10px'}} value={agentId} onChange={e=>setAgentId(e.target.value)}>
          {agents.map(a => <option key={a.id} value={a.id}>{a.name} ({a.model_name || 'default'})</option>)}
        </select>
      </div>
      <div className="chat-messages" ref={msgsRef}>
        {messages.length === 0 && (
          <div style={{textAlign:'center',color:'var(--text-dim)',marginTop:80}}>
            <p style={{fontSize:40,marginBottom:12}}>üí¨</p>
            <p>Select an agent and start chatting</p>
            <p style={{fontSize:12,marginTop:4}}>Messages are processed by your self-hosted LLM router</p>
          </div>
        )}
        {messages.map((m, i) => (
          <div key={i} className={`chat-msg ${m.role}`}>
            <div style={{whiteSpace:'pre-wrap'}}>{m.text}</div>
            {m.meta && <div className="meta">{m.meta}</div>}
          </div>
        ))}
        {loading && (
          <div className="chat-msg ai">
            <span className="typing-dot"/> <span className="typing-dot"/> <span className="typing-dot"/>
          </div>
        )}
      </div>
      <div className="chat-input-bar">
        <input className="form-input" placeholder="Type a message..." value={input}
          onChange={e=>setInput(e.target.value)}
          onKeyDown={e=>e.key==='Enter'&&send()}
          disabled={loading || !agentId}/>
        <button className="btn btn-primary" onClick={send} disabled={loading || !agentId}>Send</button>
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ Agents Page ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function AgentsPage({ token }) {
  const [agents, setAgents] = useState([]);
  const [showCreate, setShowCreate] = useState(false);
  const [form, setForm] = useState({ name: '', model_name: 'groq/llama-3.3-70b-versatile', system_prompt: '', temperature: 0.7, max_tokens: 1024 });

  const load = useCallback(() => {
    apiFetch('/v1/agents', {}, token).then(d => setAgents(d.agents || d || [])).catch(() => {});
  }, [token]);

  useEffect(() => { load(); }, [load]);

  const create = async (e) => {
    e.preventDefault();
    await apiFetch('/v1/agents', { method: 'POST', body: JSON.stringify(form) }, token);
    setShowCreate(false);
    setForm({ name: '', model_name: 'groq/llama-3.3-70b-versatile', system_prompt: '', temperature: 0.7, max_tokens: 1024 });
    load();
  };

  const set = (k) => (e) => setForm({ ...form, [k]: e.target.type === 'number' ? parseFloat(e.target.value) : e.target.value });

  return (
    <div className="fade-in">
      <div className="flex justify-between items-center mb-4">
        <p className="text-muted" style={{fontSize:13}}>{agents.length} agent{agents.length!==1?'s':''}</p>
        <div className="flex gap-3">
          <button className="btn btn-secondary btn-sm" onClick={load}>{Icons.refresh} Refresh</button>
          <button className="btn btn-primary btn-sm" onClick={()=>setShowCreate(!showCreate)}>{Icons.plus} New Agent</button>
        </div>
      </div>

      {showCreate && (
        <div className="card mb-4 fade-in">
          <h3 style={{fontSize:15,fontWeight:600,marginBottom:16}}>Create Agent</h3>
          <form onSubmit={create}>
            <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:16}}>
              <div className="form-group"><label>Name</label><input className="form-input" value={form.name} onChange={set('name')} placeholder="Research Assistant" required/></div>
              <div className="form-group"><label>Model</label>
                <select className="form-input" value={form.model_name} onChange={set('model_name')}>
                  <option value="groq/llama-3.3-70b-versatile">Groq / LLaMA 3.3 70B</option>
                  <option value="groq/llama-3.1-8b-instant">Groq / LLaMA 3.1 8B</option>
                  <option value="anthropic/claude-sonnet-4-20250514">Anthropic / Claude Sonnet</option>
                  <option value="openai/gpt-4o">OpenAI / GPT-4o</option>
                  <option value="openai/gpt-4o-mini">OpenAI / GPT-4o Mini</option>
                  <option value="deepseek/deepseek-chat">DeepSeek / Chat</option>
                </select>
              </div>
            </div>
            <div className="form-group"><label>System Prompt</label><textarea className="form-input" rows={3} value={form.system_prompt} onChange={set('system_prompt')} placeholder="You are a helpful assistant..."/></div>
            <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:16}}>
              <div className="form-group"><label>Temperature ({form.temperature})</label><input type="range" min="0" max="2" step="0.1" value={form.temperature} onChange={set('temperature')} style={{width:'100%'}}/></div>
              <div className="form-group"><label>Max Tokens</label><input className="form-input" type="number" value={form.max_tokens} onChange={set('max_tokens')} min={1} max={8192}/></div>
            </div>
            <div className="flex gap-3">
              <button className="btn btn-primary" type="submit">Create Agent</button>
              <button className="btn btn-secondary" type="button" onClick={()=>setShowCreate(false)}>Cancel</button>
            </div>
          </form>
        </div>
      )}

      <div className="card table-wrap">
        <table>
          <thead><tr><th>Name</th><th>Model</th><th>Temperature</th><th>Created</th><th>ID</th></tr></thead>
          <tbody>
            {agents.map(a => (
              <tr key={a.id}>
                <td style={{fontWeight:600}}>{a.name}</td>
                <td><span className="mono" style={{fontSize:12}}>{a.model_name || '‚Äî'}</span></td>
                <td>{a.temperature ?? '‚Äî'}</td>
                <td className="text-muted">{a.created_at ? new Date(a.created_at).toLocaleDateString() : '‚Äî'}</td>
                <td><span className="mono text-dim" style={{fontSize:11}}>{a.id?.slice(0,12)}...</span></td>
              </tr>
            ))}
            {agents.length === 0 && <tr><td colSpan={5} className="text-muted" style={{textAlign:'center',padding:40}}>No agents yet. Create one to get started.</td></tr>}
          </tbody>
        </table>
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ Runs Page ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function RunsPage({ token }) {
  const [runs, setRuns] = useState([]);

  useEffect(() => {
    apiFetch('/v1/runs', {}, token).then(d => setRuns((d.runs || d || []).slice(0, 50))).catch(() => {});
  }, [token]);

  const statusBadge = (s) => {
    const map = { completed: 'badge-green', failed: 'badge-red', pending: 'badge-amber', running: 'badge-blue' };
    return <span className={`badge ${map[s] || 'badge-blue'}`}>{s}</span>;
  };

  return (
    <div className="fade-in">
      <div className="flex justify-between items-center mb-4">
        <p className="text-muted" style={{fontSize:13}}>{runs.length} run{runs.length!==1?'s':''}</p>
        <button className="btn btn-secondary btn-sm" onClick={()=>apiFetch('/v1/runs',{},token).then(d=>setRuns((d.runs||d||[]).slice(0,50)))}>{Icons.refresh} Refresh</button>
      </div>
      <div className="card table-wrap">
        <table>
          <thead><tr><th>Status</th><th>Agent</th><th>Model</th><th>Input</th><th>Tokens</th><th>Cost</th></tr></thead>
          <tbody>
            {runs.map(r => (
              <tr key={r.id}>
                <td>{statusBadge(r.status)}</td>
                <td style={{fontWeight:500}}>{r.agent_name || r.agent_id?.slice(0,8) || '‚Äî'}</td>
                <td><span className="mono" style={{fontSize:11}}>{r.model_name || '‚Äî'}</span></td>
                <td style={{maxWidth:200,overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}}>{r.input_text?.slice(0,60) || '‚Äî'}</td>
                <td className="mono" style={{fontSize:12}}>{(r.total_input_tokens||0)+(r.total_output_tokens||0)}</td>
                <td className="mono" style={{fontSize:12}}>${(r.total_cost_usd||0).toFixed(4)}</td>
              </tr>
            ))}
            {runs.length === 0 && <tr><td colSpan={6} className="text-muted" style={{textAlign:'center',padding:40}}>No runs yet. Chat with an agent to create runs.</td></tr>}
          </tbody>
        </table>
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ Billing Page ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function BillingPage({ token }) {
  const [plans, setPlans] = useState([]);
  const [pricing, setPricing] = useState(null);

  useEffect(() => {
    apiFetch('/v1/billing/plans', {}, token).then(d => setPlans(d.plans || d || [])).catch(() => {});
    apiFetch('/v1/billing/pricing', {}, token).then(d => setPricing(d)).catch(() => {});
  }, [token]);

  return (
    <div className="fade-in">
      <h3 style={{fontSize:15,fontWeight:600,marginBottom:16}}>Available Plans</h3>
      <div className="card-grid">
        {plans.map((p, i) => (
          <div className="card" key={i} style={{borderColor: i===1 ? 'var(--accent)' : undefined}}>
            <h4 style={{fontSize:18,fontWeight:700,marginBottom:4}}>{p.name}</h4>
            <p className="text-muted" style={{fontSize:13,marginBottom:12}}>{p.description || `Tier ${i+1}`}</p>
            <div style={{fontSize:28,fontWeight:700,fontFamily:'var(--font-mono)',marginBottom:8}}>
              {p.price_monthly ? `‚Ç¨${p.price_monthly}` : 'Free'}<span className="text-muted" style={{fontSize:13,fontWeight:400}}>/mo</span>
            </div>
            <ul style={{listStyle:'none',fontSize:13,color:'var(--text-muted)'}}>
              {(p.features || []).slice(0, 5).map((f, j) => <li key={j} style={{padding:'4px 0'}}>‚úì {f}</li>)}
            </ul>
          </div>
        ))}
      </div>
      {pricing && (
        <>
          <h3 style={{fontSize:15,fontWeight:600,marginBottom:12,marginTop:24}}>Pricing Tiers</h3>
          <div className="card table-wrap">
            <table>
              <thead><tr><th>Tier</th><th>Provider</th><th>Model</th><th>Cost/1K Tokens</th></tr></thead>
              <tbody>
                {(pricing.tiers || Object.entries(pricing).filter(([k]) => k !== 'meta')).map((t, i) => {
                  const tier = Array.isArray(t) ? t[1] : t;
                  const name = Array.isArray(t) ? t[0] : tier.name;
                  return (
                    <tr key={i}>
                      <td><span className="badge badge-blue">{name}</span></td>
                      <td>{tier.provider || '‚Äî'}</td>
                      <td className="mono" style={{fontSize:12}}>{tier.model || '‚Äî'}</td>
                      <td className="mono">${tier.cost_per_1k || tier.price || '‚Äî'}</td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>
        </>
      )}
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ Guardians Page ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function GuardiansPage({ token }) {
  const [guardians, setGuardians] = useState([]);

  useEffect(() => {
    apiFetch('/v1/platform/guardians/status', {}, token).then(d => setGuardians(d.guardians || [])).catch(() => {});
  }, [token]);

  const colors = ['var(--green)', 'var(--accent)', 'var(--purple)', 'var(--cyan)', 'var(--amber)', 'var(--red)'];

  return (
    <div className="fade-in">
      <div className="flex justify-between items-center mb-4">
        <p className="text-muted" style={{fontSize:13}}>{guardians.length} guardian{guardians.length!==1?'s':''} active</p>
        <button className="btn btn-secondary btn-sm" onClick={()=>apiFetch('/v1/platform/guardians/status',{},token).then(d=>setGuardians(d.guardians||[]))}>{Icons.refresh} Refresh</button>
      </div>
      <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(320px,1fr))',gap:16}}>
        {guardians.map((g, i) => (
          <div className="card" key={i}>
            <div className="flex items-center gap-3" style={{marginBottom:12}}>
              <div style={{width:44,height:44,borderRadius:'50%',background:`${colors[i%6]}22`,display:'flex',alignItems:'center',justifyContent:'center',fontSize:22}}>
                {g.emoji || 'üõ°Ô∏è'}
              </div>
              <div>
                <div style={{fontWeight:600,fontSize:15}}>{g.name}</div>
                <div style={{fontSize:12,color:'var(--text-muted)'}}>{g.role || g.focus}</div>
              </div>
              <span className={`badge ${g.status==='active'?'badge-green':'badge-amber'}`} style={{marginLeft:'auto'}}>{g.status}</span>
            </div>
            {g.personality && <p style={{fontSize:13,color:'var(--text-muted)',lineHeight:1.5}}>{g.personality.slice(0, 120)}...</p>}
            {g.last_check && <p className="mono" style={{fontSize:11,color:'var(--text-dim)',marginTop:8}}>Last check: {g.last_check}</p>}
          </div>
        ))}
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ Admin Page ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function AdminPage({ token }) {
  const [info, setInfo] = useState(null);
  const [audit, setAudit] = useState([]);

  useEffect(() => {
    apiFetch('/v1/version', {}, token).then(d => setInfo(d)).catch(() => setInfo({ version: '?', modules: 0 }));
    apiFetch('/v1/audit/logs', {}, token).then(d => setAudit((d.logs || d || []).slice(0, 20))).catch(() => {});
  }, [token]);

  return (
    <div className="fade-in">
      <h3 style={{fontSize:15,fontWeight:600,marginBottom:16}}>System Information</h3>
      {info && (
        <div className="card-grid">
          <div className="card stat-card">
            <div className="stat-value mono">{info.version || '?'}</div>
            <div className="stat-label">Version</div>
          </div>
          <div className="card stat-card">
            <div className="stat-value text-green">{info.modules_loaded ?? info.modules ?? '?'}</div>
            <div className="stat-label">Modules Loaded</div>
          </div>
          <div className="card stat-card">
            <div className="stat-value" style={{color:'var(--cyan)'}}>{info.uptime || '‚Äî'}</div>
            <div className="stat-label">Uptime</div>
          </div>
        </div>
      )}

      <h3 style={{fontSize:15,fontWeight:600,marginBottom:12,marginTop:24}}>Audit Log</h3>
      <div className="card table-wrap">
        <table>
          <thead><tr><th>Timestamp</th><th>Action</th><th>Actor</th><th>Detail</th></tr></thead>
          <tbody>
            {audit.map((e, i) => (
              <tr key={i}>
                <td className="mono" style={{fontSize:11,whiteSpace:'nowrap'}}>{e.timestamp || e.created_at || '‚Äî'}</td>
                <td><span className="badge badge-blue">{e.action || e.event_type || '‚Äî'}</span></td>
                <td>{e.actor || e.user_id || '‚Äî'}</td>
                <td style={{maxWidth:300,overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}} className="text-muted">{e.detail || e.description || JSON.stringify(e.data||{}).slice(0,80)}</td>
              </tr>
            ))}
            {audit.length === 0 && <tr><td colSpan={4} className="text-muted" style={{textAlign:'center',padding:40}}>No audit logs yet.</td></tr>}
          </tbody>
        </table>
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ Main App ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function App() {
  const [token, setToken] = useState(null);
  const [email, setEmail] = useState('');
  const [page, setPage] = useState('dashboard');

  const handleAuth = (t, e) => { setToken(t); setEmail(e); };
  const logout = () => { setToken(null); setEmail(''); setPage('dashboard'); };

  if (!token) return <LoginPage onAuth={handleAuth} />;

  const pages = {
    dashboard: { label: 'Dashboard', icon: Icons.dashboard, component: Dashboard },
    chat: { label: 'Chat', icon: Icons.chat, component: ChatPage },
    agents: { label: 'Agents', icon: Icons.agents, component: AgentsPage },
    runs: { label: 'Runs', icon: Icons.runs, component: RunsPage },
    billing: { label: 'Billing', icon: Icons.billing, component: BillingPage },
    guardians: { label: 'Guardians', icon: Icons.shield, component: GuardiansPage },
    admin: { label: 'Admin', icon: Icons.settings, component: AdminPage },
  };

  const PageComponent = pages[page]?.component || Dashboard;

  return (
    <AuthCtx.Provider value={{ token, email }}>
      <div className="app">
        <div className="sidebar">
          <div className="sidebar-brand">
            <div className="dot"/>
            <h1>Punky</h1>
          </div>
          <div className="sidebar-nav">
            <div className="nav-section">Main</div>
            {['dashboard', 'chat', 'agents', 'runs'].map(k => (
              <div key={k} className={`nav-item ${page===k?'active':''}`} onClick={()=>setPage(k)}>
                {pages[k].icon} {pages[k].label}
              </div>
            ))}
            <div className="nav-section">Platform</div>
            {['billing', 'guardians', 'admin'].map(k => (
              <div key={k} className={`nav-item ${page===k?'active':''}`} onClick={()=>setPage(k)}>
                {pages[k].icon} {pages[k].label}
              </div>
            ))}
          </div>
          <div className="sidebar-footer">
            <div className="flex items-center justify-between">
              <span style={{fontSize:12}}>{email.split('@')[0]}</span>
              <span style={{cursor:'pointer',opacity:.6}} onClick={logout} title="Sign out">{Icons.logout}</span>
            </div>
          </div>
        </div>
        <div className="main">
          <div className="topbar">
            <h2>{pages[page]?.label || 'Dashboard'}</h2>
            <div className="topbar-actions">
              <span className="badge badge-green">Connected</span>
              <span className="mono text-dim" style={{fontSize:11}}>API: {API.replace('https://','')}</span>
            </div>
          </div>
          <div className="content">
            <PageComponent token={token} />
          </div>
        </div>
      </div>
    </AuthCtx.Provider>
  );
}

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
