<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Punky — Autonomous Agent Platform</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--bg:#0a0a0f;--surface:#12121a;--surface2:#1a1a28;--border:#2a2a3e;--text:#e4e4f0;--text2:#8888a8;--accent:#6c5ce7;--accent2:#a29bfe;--green:#00d68f;--red:#ff6b6b;--orange:#ffa94d;--blue:#4dabf7}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--text);font-family:'Plus Jakarta Sans',sans-serif;min-height:100vh}
.mono{font-family:'JetBrains Mono',monospace}
input,select,textarea{background:var(--surface2);border:1px solid var(--border);color:var(--text);border-radius:8px;padding:10px 14px;font-size:14px;font-family:inherit;width:100%;outline:none;transition:border-color .2s}
input:focus,select:focus{border-color:var(--accent)}
button{cursor:pointer;border:none;border-radius:8px;font-family:inherit;font-size:14px;font-weight:600;padding:10px 20px;transition:all .15s}
.btn-primary{background:var(--accent);color:#fff}
.btn-primary:hover{background:var(--accent2);transform:translateY(-1px)}
.btn-ghost{background:transparent;color:var(--text2);border:1px solid var(--border)}
.btn-ghost:hover{border-color:var(--accent);color:var(--text)}
.btn-sm{padding:6px 14px;font-size:12px}
.badge{display:inline-block;padding:3px 10px;border-radius:12px;font-size:11px;font-weight:600;letter-spacing:.5px;text-transform:uppercase}
.badge-green{background:rgba(0,214,143,.15);color:var(--green)}
.badge-red{background:rgba(255,107,107,.15);color:var(--red)}
.badge-orange{background:rgba(255,169,77,.15);color:var(--orange)}
.badge-blue{background:rgba(77,171,247,.15);color:var(--blue)}
.badge-purple{background:rgba(108,92,231,.15);color:var(--accent2)}
.card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:24px}
.card-hover:hover{border-color:var(--accent);transform:translateY(-2px);transition:all .2s}
table{width:100%;border-collapse:collapse}
th{text-align:left;font-size:11px;font-weight:600;color:var(--text2);text-transform:uppercase;letter-spacing:.5px;padding:12px 16px;border-bottom:1px solid var(--border)}
td{padding:12px 16px;border-bottom:1px solid var(--border);font-size:14px}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
.fade-in{animation:fadeIn .3s ease-out}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.pulse{animation:pulse 2s infinite}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useCallback } = React;

const API = window.location.hostname === 'localhost' ? 'http://localhost:8081' : 'https://api.jspriggins.com';

// ─── API Client ───────────────────────────────────────────────────
const api = {
  token: null,
  apiKey: null,
  async req(method, path, body) {
    const h = {'Content-Type': 'application/json'};
    if (this.token) h['Authorization'] = `Bearer ${this.token}`;
    else if (this.apiKey) h['X-API-Key'] = this.apiKey;
    const r = await fetch(`${API}${path}`, {method, headers: h, body: body ? JSON.stringify(body) : undefined});
    if (r.status === 204) return null;
    const data = await r.json().catch(() => null);
    if (!r.ok) throw new Error(data?.detail || `HTTP ${r.status}`);
    return data;
  },
  get: (p) => api.req('GET', p),
  post: (p, b) => api.req('POST', p, b),
  patch: (p, b) => api.req('PATCH', p, b),
  del: (p) => api.req('DELETE', p),
};

// ─── Icons (inline SVG) ──────────────────────────────────────────
const Icon = ({name, size=18}) => {
  const icons = {
    bot: <path d="M12 8V4H8M2 14h20M6 14v4h12v-4M6 8h12a2 2 0 012 2v4H4v-4a2 2 0 012-2z"/>,
    play: <polygon points="5 3 19 12 5 21 5 3"/>,
    plug: <path d="M12 22v-5M5 12H2M22 12h-3M12 2v5M7 7L5 5M17 7l2-2M17 17l2 2M7 17L5 19M12 12m-3 0a3 3 0 106 0 3 3 0 00-6 0z"/>,
    dollar: <path d="M12 1v22M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/>,
    home: <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>,
    logout: <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9"/>,
    check: <polyline points="20 6 9 17 4 12"/>,
    x: <path d="M18 6L6 18M6 6l12 12"/>,
    clock: <circle cx="12" cy="12" r="10"/>,
    zap: <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>,
    shield: <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>,
  };
  return <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">{icons[name]}</svg>;
};

// ─── Login Screen ─────────────────────────────────────────────────
function LoginPage({onLogin}) {
  const [mode, setMode] = useState('login'); // login | register
  const [form, setForm] = useState({name:'', email:'', password:'', slug:''});
  const [err, setErr] = useState('');
  const [loading, setLoading] = useState(false);

  const handleRegister = async () => {
    setLoading(true); setErr('');
    try {
      const t = await api.post('/v1/tenants', {name: form.name, owner_email: form.email});
      await api.post('/v1/auth/set-password', {tenant_id: t.slug, email: form.email, password: form.password});
      const login = await api.post('/v1/auth/login', {tenant_id: t.slug, email: form.email, password: form.password});
      api.token = login.access_token; api.apiKey = t.api_key;
      onLogin({...login, slug: t.slug, api_key: t.api_key, tenant_id: t.tenant_id});
    } catch(e) { setErr(e.message); } finally { setLoading(false); }
  };

  const handleLogin = async () => {
    setLoading(true); setErr('');
    try {
      const login = await api.post('/v1/auth/login', {tenant_id: form.slug, email: form.email, password: form.password});
      api.token = login.access_token;
      onLogin({...login, slug: form.slug});
    } catch(e) { setErr(e.message); } finally { setLoading(false); }
  };

  return (
    <div style={{display:'flex',alignItems:'center',justifyContent:'center',minHeight:'100vh',padding:20}}>
      <div className="card fade-in" style={{maxWidth:420,width:'100%'}}>
        <div style={{textAlign:'center',marginBottom:32}}>
          <div style={{fontSize:40,marginBottom:8}}>⚡</div>
          <h1 style={{fontSize:28,fontWeight:800,background:'linear-gradient(135deg,var(--accent),var(--accent2))',WebkitBackgroundClip:'text',WebkitTextFillColor:'transparent'}}>Punky</h1>
          <p style={{color:'var(--text2)',fontSize:14,marginTop:4}}>Autonomous Agent Platform</p>
        </div>
        <div style={{display:'flex',gap:8,marginBottom:24}}>
          <button className={mode==='login'?'btn-primary':'btn-ghost'} style={{flex:1}} onClick={()=>setMode('login')}>Sign In</button>
          <button className={mode==='register'?'btn-primary':'btn-ghost'} style={{flex:1}} onClick={()=>setMode('register')}>Register</button>
        </div>
        {mode==='register' && <input placeholder="Organization name" value={form.name} onChange={e=>setForm({...form,name:e.target.value})} style={{marginBottom:12}}/>}
        {mode==='login' && <input placeholder="Tenant slug" value={form.slug} onChange={e=>setForm({...form,slug:e.target.value})} style={{marginBottom:12}}/>}
        <input placeholder="Email" type="email" value={form.email} onChange={e=>setForm({...form,email:e.target.value})} style={{marginBottom:12}}/>
        <input placeholder="Password" type="password" value={form.password} onChange={e=>setForm({...form,password:e.target.value})} style={{marginBottom:16}} onKeyDown={e=>e.key==='Enter'&&(mode==='login'?handleLogin():handleRegister())}/>
        {err && <div style={{color:'var(--red)',fontSize:13,marginBottom:12}}>{err}</div>}
        <button className="btn-primary" style={{width:'100%'}} onClick={mode==='login'?handleLogin:handleRegister} disabled={loading}>
          {loading ? 'Loading...' : mode==='login' ? 'Sign In' : 'Create Account'}
        </button>
      </div>
    </div>
  );
}

// ─── Sidebar ───────────────────────────────────────────────────────
function Sidebar({active, setActive, session, onLogout}) {
  const items = [{id:'dashboard',icon:'home',label:'Dashboard'},{id:'agents',icon:'bot',label:'Agents'},{id:'runs',icon:'play',label:'Runs'},{id:'connectors',icon:'plug',label:'Connectors'},{id:'billing',icon:'dollar',label:'Billing'}];
  return (
    <div style={{width:220,background:'var(--surface)',borderRight:'1px solid var(--border)',display:'flex',flexDirection:'column',height:'100vh',position:'fixed'}}>
      <div style={{padding:'20px 16px',borderBottom:'1px solid var(--border)'}}>
        <div style={{display:'flex',alignItems:'center',gap:8}}><span style={{fontSize:24}}>⚡</span><span style={{fontWeight:800,fontSize:18}}>Punky</span></div>
        <div className="mono" style={{fontSize:11,color:'var(--text2)',marginTop:4}}>{session?.slug || 'workspace'}</div>
      </div>
      <nav style={{flex:1,padding:'12px 8px'}}>
        {items.map(it=>(
          <div key={it.id} onClick={()=>setActive(it.id)} style={{display:'flex',alignItems:'center',gap:10,padding:'10px 12px',borderRadius:8,cursor:'pointer',marginBottom:2,background:active===it.id?'var(--surface2)':'transparent',color:active===it.id?'var(--text)':'var(--text2)',transition:'all .15s'}}>
            <Icon name={it.icon} size={16}/><span style={{fontSize:14,fontWeight:active===it.id?600:400}}>{it.label}</span>
          </div>
        ))}
      </nav>
      <div style={{padding:16,borderTop:'1px solid var(--border)'}}>
        <button className="btn-ghost btn-sm" style={{width:'100%',display:'flex',alignItems:'center',justifyContent:'center',gap:6}} onClick={onLogout}><Icon name="logout" size={14}/>Sign Out</button>
      </div>
    </div>
  );
}

// ─── Dashboard ────────────────────────────────────────────────────
function Dashboard({}) {
  const [data, setData] = useState({agents:[], runs:[], usage:{}});
  useEffect(()=>{
    Promise.all([api.get('/v1/agents').catch(()=>[]), api.get('/v1/runs').catch(()=>[]), api.get('/v1/billing/usage').catch(()=>({}))]).then(([a,r,u])=>setData({agents:a,runs:r,usage:u}));
  },[]);
  const cards = [
    {label:'Agents', value:data.agents.length, icon:'bot', color:'var(--accent2)'},
    {label:'Total Runs', value:data.runs.length, icon:'play', color:'var(--green)'},
    {label:'Cost (USD)', value:`$${(data.usage?.total_cost_usd||0).toFixed(4)}`, icon:'dollar', color:'var(--orange)'},
    {label:'Succeeded', value:data.runs.filter(r=>r.status==='succeeded').length, icon:'check', color:'var(--green)'},
  ];
  return (
    <div className="fade-in">
      <h2 style={{fontSize:24,fontWeight:700,marginBottom:24}}>Dashboard</h2>
      <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(200px,1fr))',gap:16,marginBottom:32}}>
        {cards.map((c,i)=>(
          <div key={i} className="card" style={{display:'flex',alignItems:'center',gap:16}}>
            <div style={{width:44,height:44,borderRadius:10,background:`${c.color}20`,display:'flex',alignItems:'center',justifyContent:'center',color:c.color}}><Icon name={c.icon} size={20}/></div>
            <div><div style={{fontSize:11,color:'var(--text2)',fontWeight:600,textTransform:'uppercase',letterSpacing:'.5px'}}>{c.label}</div><div style={{fontSize:22,fontWeight:700,marginTop:2}} className="mono">{c.value}</div></div>
          </div>
        ))}
      </div>
      <h3 style={{fontSize:16,fontWeight:600,marginBottom:12}}>Recent Runs</h3>
      <div className="card" style={{padding:0,overflow:'hidden'}}>
        <table><thead><tr><th>Task</th><th>Status</th><th>Cost</th><th>Time</th></tr></thead>
        <tbody>{data.runs.slice(0,8).map(r=>(
          <tr key={r.id}><td style={{maxWidth:300,overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}}>{r.task}</td>
          <td><span className={`badge badge-${r.status==='succeeded'?'green':r.status==='failed'?'red':r.status==='running'?'blue':'purple'}`}>{r.status}</span></td>
          <td className="mono" style={{fontSize:13}}>${(r.total_cost_usd||0).toFixed(4)}</td>
          <td style={{color:'var(--text2)',fontSize:13}}>{r.created_at?.slice(11,19)}</td></tr>
        ))}{data.runs.length===0 && <tr><td colSpan={4} style={{color:'var(--text2)',textAlign:'center',padding:32}}>No runs yet — submit your first task!</td></tr>}</tbody></table>
      </div>
    </div>
  );
}

// ─── Agents Page ──────────────────────────────────────────────────
function AgentsPage({}) {
  const [agents, setAgents] = useState([]);
  const [show, setShow] = useState(false);
  const [form, setForm] = useState({name:'',description:'',agent_type:'general',system_prompt:'',default_tier:'CHEAP',risk_level:'low',max_steps:10});
  const load = useCallback(()=>api.get('/v1/agents').then(setAgents).catch(()=>{}),[]);
  useEffect(()=>{load()},[load]);
  const create = async()=>{await api.post('/v1/agents',form);setShow(false);load();};
  const activate = async(id)=>{await api.patch(`/v1/agents/${id}/activate`);load();};
  const pause = async(id)=>{await api.patch(`/v1/agents/${id}/pause`);load();};
  return (
    <div className="fade-in">
      <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:24}}>
        <h2 style={{fontSize:24,fontWeight:700}}>Agents</h2>
        <button className="btn-primary" onClick={()=>setShow(!show)}>+ New Agent</button>
      </div>
      {show && <div className="card" style={{marginBottom:20}}>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <input placeholder="Name" value={form.name} onChange={e=>setForm({...form,name:e.target.value})}/>
          <select value={form.agent_type} onChange={e=>setForm({...form,agent_type:e.target.value})}><option>general</option><option>researcher</option><option>coder</option><option>guardian</option></select>
          <input placeholder="Description" value={form.description} onChange={e=>setForm({...form,description:e.target.value})} style={{gridColumn:'span 2'}}/>
          <textarea placeholder="System prompt" value={form.system_prompt} onChange={e=>setForm({...form,system_prompt:e.target.value})} rows={3} style={{gridColumn:'span 2',resize:'vertical'}}/>
          <select value={form.default_tier} onChange={e=>setForm({...form,default_tier:e.target.value})}><option>CHEAP</option><option>MEDIUM</option><option>PREMIUM</option><option>RESEARCH</option></select>
          <select value={form.risk_level} onChange={e=>setForm({...form,risk_level:e.target.value})}><option>low</option><option>medium</option><option>high</option></select>
        </div>
        <div style={{marginTop:12,display:'flex',gap:8}}><button className="btn-primary btn-sm" onClick={create}>Create</button><button className="btn-ghost btn-sm" onClick={()=>setShow(false)}>Cancel</button></div>
      </div>}
      <div style={{display:'grid',gap:12}}>
        {agents.map(a=>(
          <div key={a.id} className="card card-hover" style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
            <div><div style={{fontWeight:600}}>{a.name}</div><div style={{fontSize:13,color:'var(--text2)',marginTop:2}}>{a.agent_type} · {a.default_tier} · risk:{a.risk_level}</div><div className="mono" style={{fontSize:11,color:'var(--text2)',marginTop:4}}>{a.id}</div></div>
            <div style={{display:'flex',alignItems:'center',gap:8}}>
              <span className={`badge badge-${a.status==='active'?'green':'orange'}`}>{a.status}</span>
              {a.status==='draft'&&<button className="btn-primary btn-sm" onClick={()=>activate(a.id)}>Activate</button>}
              {a.status==='active'&&<button className="btn-ghost btn-sm" onClick={()=>pause(a.id)}>Pause</button>}
            </div>
          </div>
        ))}
        {agents.length===0&&<div className="card" style={{textAlign:'center',color:'var(--text2)',padding:40}}>No agents yet — create one to get started</div>}
      </div>
    </div>
  );
}

// ─── Runs Page ────────────────────────────────────────────────────
function RunsPage({}) {
  const [runs, setRuns] = useState([]);
  const [agents, setAgents] = useState([]);
  const [show, setShow] = useState(false);
  const [form, setForm] = useState({agent_id:'',task:'',mode:'execute'});
  const [detail, setDetail] = useState(null);
  const [steps, setSteps] = useState([]);
  const load = useCallback(()=>{api.get('/v1/runs').then(setRuns).catch(()=>{});api.get('/v1/agents').then(setAgents).catch(()=>[]);},[]);
  useEffect(()=>{load()},[load]);
  const submit = async()=>{await api.post('/v1/runs',form);setShow(false);setTimeout(load,1500);load();};
  const viewSteps = async(r)=>{setDetail(r);const s=await api.get(`/v1/runs/${r.id}/steps`).catch(()=>[]);setSteps(s);};
  return (
    <div className="fade-in">
      <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:24}}>
        <h2 style={{fontSize:24,fontWeight:700}}>Runs</h2>
        <div style={{display:'flex',gap:8}}><button className="btn-ghost btn-sm" onClick={load}>↻ Refresh</button><button className="btn-primary" onClick={()=>setShow(!show)}>+ Submit Task</button></div>
      </div>
      {show && <div className="card" style={{marginBottom:20}}>
        <select value={form.agent_id} onChange={e=>setForm({...form,agent_id:e.target.value})} style={{marginBottom:12}}>
          <option value="">Select agent...</option>{agents.filter(a=>a.status==='active').map(a=><option key={a.id} value={a.id}>{a.name}</option>)}
        </select>
        <textarea placeholder="Task description..." value={form.task} onChange={e=>setForm({...form,task:e.target.value})} rows={3} style={{marginBottom:12,resize:'vertical'}}/>
        <div style={{display:'flex',gap:8}}><button className="btn-primary btn-sm" onClick={submit} disabled={!form.agent_id||!form.task}>Submit</button><button className="btn-ghost btn-sm" onClick={()=>setShow(false)}>Cancel</button></div>
      </div>}
      {detail && <div className="card" style={{marginBottom:20}}>
        <div style={{display:'flex',justifyContent:'space-between',marginBottom:16}}><h3 style={{fontWeight:600}}>Run Details</h3><button className="btn-ghost btn-sm" onClick={()=>setDetail(null)}>✕ Close</button></div>
        <div style={{fontSize:13,color:'var(--text2)',marginBottom:8}}>{detail.task}</div>
        <div style={{display:'flex',gap:16,marginBottom:16,fontSize:13}}>
          <span className={`badge badge-${detail.status==='succeeded'?'green':detail.status==='failed'?'red':'blue'}`}>{detail.status}</span>
          <span className="mono">${(detail.total_cost_usd||0).toFixed(4)}</span>
          <span>{detail.step_count} steps</span>
        </div>
        <h4 style={{fontSize:13,fontWeight:600,color:'var(--text2)',marginBottom:8}}>Steps</h4>
        {steps.map((s,i)=>(<div key={s.id} style={{padding:'10px 14px',background:'var(--surface2)',borderRadius:8,marginBottom:6,fontSize:13}}>
          <div style={{display:'flex',justifyContent:'space-between'}}><span><span style={{color:'var(--accent2)',fontWeight:600}}>#{s.sequence}</span> {s.step_type}</span><span className={`badge badge-${s.status==='succeeded'?'green':'red'}`} style={{fontSize:10}}>{s.status}</span></div>
          <div style={{color:'var(--text2)',marginTop:4}}>{s.description}</div>
          {s.duration_ms!=null&&<div className="mono" style={{fontSize:11,color:'var(--text2)',marginTop:2}}>{s.duration_ms}ms · ${(s.cost_usd||0).toFixed(4)}</div>}
        </div>))}
        {steps.length===0&&<div style={{color:'var(--text2)',fontSize:13}}>No steps recorded</div>}
      </div>}
      <div className="card" style={{padding:0,overflow:'hidden'}}>
        <table><thead><tr><th>Task</th><th>Agent</th><th>Status</th><th>Cost</th><th>Steps</th><th></th></tr></thead>
        <tbody>{runs.map(r=>(
          <tr key={r.id}>
            <td style={{maxWidth:250,overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}}>{r.task}</td>
            <td className="mono" style={{fontSize:12}}>{(r.agent_id||'').slice(0,8)}</td>
            <td><span className={`badge badge-${r.status==='succeeded'?'green':r.status==='failed'?'red':r.status==='running'?'blue':'purple'}`}>{r.status}</span></td>
            <td className="mono" style={{fontSize:13}}>${(r.total_cost_usd||0).toFixed(4)}</td>
            <td className="mono">{r.step_count}</td>
            <td><button className="btn-ghost btn-sm" onClick={()=>viewSteps(r)}>Details</button></td>
          </tr>
        ))}</tbody></table>
      </div>
    </div>
  );
}

// ─── Connectors Page ──────────────────────────────────────────────
function ConnectorsPage({}) {
  const [conns, setConns] = useState([]);
  const [show, setShow] = useState(false);
  const [form, setForm] = useState({name:'',connector_type:'github',config:{}});
  const load = useCallback(()=>api.get('/v1/connectors').then(setConns).catch(()=>{}),[]);
  useEffect(()=>{load()},[load]);
  const create = async()=>{await api.post('/v1/connectors',form);setShow(false);load();};
  const remove = async(id)=>{await api.del(`/v1/connectors/${id}`);load();};
  const types = ['github','gitlab','slack','webhook','browser','custom'];
  return (
    <div className="fade-in">
      <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:24}}>
        <h2 style={{fontSize:24,fontWeight:700}}>Connectors</h2>
        <button className="btn-primary" onClick={()=>setShow(!show)}>+ Add Connector</button>
      </div>
      {show && <div className="card" style={{marginBottom:20}}>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <input placeholder="Name" value={form.name} onChange={e=>setForm({...form,name:e.target.value})}/>
          <select value={form.connector_type} onChange={e=>setForm({...form,connector_type:e.target.value})}>{types.map(t=><option key={t}>{t}</option>)}</select>
        </div>
        <div style={{marginTop:12,display:'flex',gap:8}}><button className="btn-primary btn-sm" onClick={create}>Create</button><button className="btn-ghost btn-sm" onClick={()=>setShow(false)}>Cancel</button></div>
      </div>}
      <div style={{display:'grid',gap:12}}>
        {conns.map(c=>(
          <div key={c.id} className="card card-hover" style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
            <div><div style={{fontWeight:600}}>{c.name}</div><div style={{fontSize:13,color:'var(--text2)',marginTop:2}}>{c.connector_type}</div></div>
            <div style={{display:'flex',gap:8,alignItems:'center'}}>
              <span className={`badge badge-${c.status==='active'?'green':'orange'}`}>{c.status}</span>
              <button className="btn-ghost btn-sm" onClick={()=>remove(c.id)}>Delete</button>
            </div>
          </div>
        ))}
        {conns.length===0&&<div className="card" style={{textAlign:'center',color:'var(--text2)',padding:40}}>No connectors — add one to integrate external services</div>}
      </div>
    </div>
  );
}

// ─── Billing Page ─────────────────────────────────────────────────
function BillingPage({}) {
  const [plans, setPlans] = useState([]);
  const [usage, setUsage] = useState({});
  useEffect(()=>{
    api.get('/v1/billing/plans').then(setPlans).catch(()=>{});
    api.get('/v1/billing/usage').then(setUsage).catch(()=>{});
  },[]);
  return (
    <div className="fade-in">
      <h2 style={{fontSize:24,fontWeight:700,marginBottom:24}}>Billing & Usage</h2>
      <div className="card" style={{marginBottom:24}}>
        <h3 style={{fontSize:16,fontWeight:600,marginBottom:16}}>Current Period</h3>
        <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(150px,1fr))',gap:20}}>
          <div><div style={{fontSize:11,color:'var(--text2)',textTransform:'uppercase',letterSpacing:'.5px'}}>Period</div><div className="mono" style={{fontSize:18,fontWeight:700,marginTop:4}}>{usage.period||'—'}</div></div>
          <div><div style={{fontSize:11,color:'var(--text2)',textTransform:'uppercase',letterSpacing:'.5px'}}>Runs</div><div className="mono" style={{fontSize:18,fontWeight:700,marginTop:4}}>{usage.total_runs||0}</div></div>
          <div><div style={{fontSize:11,color:'var(--text2)',textTransform:'uppercase',letterSpacing:'.5px'}}>Cost</div><div className="mono" style={{fontSize:18,fontWeight:700,marginTop:4,color:'var(--orange)'}}>${(usage.total_cost_usd||0).toFixed(4)}</div></div>
          <div><div style={{fontSize:11,color:'var(--text2)',textTransform:'uppercase',letterSpacing:'.5px'}}>Budget Left</div><div className="mono" style={{fontSize:18,fontWeight:700,marginTop:4,color:'var(--green)'}}>${(usage.budget_remaining_usd||0).toFixed(2)}</div></div>
          <div><div style={{fontSize:11,color:'var(--text2)',textTransform:'uppercase',letterSpacing:'.5px'}}>Input Tokens</div><div className="mono" style={{fontSize:18,fontWeight:700,marginTop:4}}>{(usage.total_input_tokens||0).toLocaleString()}</div></div>
          <div><div style={{fontSize:11,color:'var(--text2)',textTransform:'uppercase',letterSpacing:'.5px'}}>Output Tokens</div><div className="mono" style={{fontSize:18,fontWeight:700,marginTop:4}}>{(usage.total_output_tokens||0).toLocaleString()}</div></div>
        </div>
      </div>
      <h3 style={{fontSize:16,fontWeight:600,marginBottom:12}}>Available Plans</h3>
      <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(220px,1fr))',gap:16}}>
        {plans.map(p=>(
          <div key={p.tier} className="card card-hover">
            <div style={{fontSize:13,fontWeight:700,textTransform:'uppercase',color:'var(--accent2)',letterSpacing:1,marginBottom:8}}>{p.tier}</div>
            <div style={{fontSize:22,fontWeight:800}}>{p.monthly_price_eur===0?'Free':`€${p.monthly_price_eur}/mo`}</div>
            <div style={{marginTop:12,fontSize:13,color:'var(--text2)',lineHeight:1.8}}>
              <div>Up to {p.max_agents} agents</div>
              <div>Up to {p.max_users} users</div>
              <div>{p.max_runs_per_month?.toLocaleString()||100} runs/mo</div>
              {p.includes_voice&&<div style={{color:'var(--green)'}}>✓ Voice</div>}
              {p.includes_premium_models&&<div style={{color:'var(--green)'}}>✓ Premium models</div>}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

// ─── Main App ─────────────────────────────────────────────────────
function App() {
  const [session, setSession] = useState(null);
  const [page, setPage] = useState('dashboard');

  const onLogin = (s) => setSession(s);
  const onLogout = () => { api.token = null; api.apiKey = null; setSession(null); };

  if (!session) return <LoginPage onLogin={onLogin}/>;

  const pages = {dashboard: Dashboard, agents: AgentsPage, runs: RunsPage, connectors: ConnectorsPage, billing: BillingPage};
  const PageComponent = pages[page] || Dashboard;

  return (
    <div style={{display:'flex'}}>
      <Sidebar active={page} setActive={setPage} session={session} onLogout={onLogout}/>
      <div style={{marginLeft:220,flex:1,padding:32,maxWidth:1100}}>
        <PageComponent/>
      </div>
    </div>
  );
}

ReactDOM.render(<App/>, document.getElementById('root'));
</script>
</body>
</html>
