name: Query Traefik API routers
on:
  push:
    branches: [ main ]
    paths: [ '.github/workflows/fix10.yml' ]
jobs:
  fix:
    runs-on: ubuntu-latest
    timeout-minutes: 6
    steps:
      - name: Install sshpass
        run: sudo apt-get install -y sshpass
      - name: Query Traefik API for jspriggins routes
        env:
          SP: JKj3nhnaij3P
        run: |
          sshpass -p "$SP" ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null root@49.12.236.136 "curl -s http://localhost:8080/api/http/routers 2>/dev/null | python3 -c \"import sys,json; routes=json.load(sys.stdin); [print(r.get('name'), r.get('rule'), r.get('service'), r.get('status')) for r in routes if 'jspriggins' in str(r.get('rule',''))]\" 2>/dev/null || docker exec coolify-proxy wget -qO- http://localhost:8080/api/http/routers 2>/dev/null | python3 -c \"import sys,json; routes=json.load(sys.stdin); [print(r.get('name'), '|', r.get('rule'), '|', r.get('service'), '|', r.get('status')) for r in routes if 'jspriggins' in str(r.get('rule',''))]\" 2>/dev/null || echo TRAEFIK_API_UNAVAILABLE"
