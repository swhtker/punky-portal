name: Restore punky-site (one-shot)
on:
  push:
    branches: [main]
    paths: [".github/workflows/site-restore.yml", ".github/scripts/restore_site.py"]

jobs:
  restore:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    env:
      SSH_PASS: JKj3nhnaij3P
    steps:
      - uses: actions/checkout@v4

      - name: Install paramiko
        run: pip install paramiko -q

      - name: Run restore script
        run: python3 .github/scripts/restore_site.py

      - name: Trigger Coolify deploy
        run: |
          curl -sf -X POST             "https://coolify.jspriggins.com/api/v1/deploy?uuid=ccoss8so04kksc4c80kwgg84&force=false"             -H "Authorization: Bearer ${{ secrets.COOLIFY_TOKEN }}"             -o /dev/null -w "HTTP %{http_code}\n"
