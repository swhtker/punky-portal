name: Patch Traefik coolify.yaml for punky-site
on:
  push:
    branches: [ main ]
    paths: [ '.github/workflows/fix5.yml' ]
jobs:
  fix:
    runs-on: ubuntu-latest
    timeout-minutes: 6
    steps:
      - name: Install sshpass
        run: sudo apt-get install -y sshpass
      - name: Show and patch coolify.yaml
        env:
          SP: JKj3nhnaij3P
        run: |
          sshpass -p "$SP" ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null root@49.12.236.136 "cat /data/coolify/proxy/dynamic/coolify.yaml"
      - name: Patch coolify.yaml â€” replace old UUID with new container
        env:
          SP: JKj3nhnaij3P
        run: |
          sshpass -p "$SP" ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null root@49.12.236.136 "sed -i 's/ccoss8so04kksc4c80kwgg84/bgwco0cgcsw4ws8w840cs0kg/g' /data/coolify/proxy/dynamic/coolify.yaml && echo 'Patched. New content:' && cat /data/coolify/proxy/dynamic/coolify.yaml"
